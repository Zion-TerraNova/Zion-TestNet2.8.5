<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="ZION Whitepaper v2.8.5 Milky Way - Full document" />
  <title>ZION Whitepaper v2.8.5 | Milky Way</title>
  <link rel="icon" href="assets/icons/zion.gif" type="image/gif" />
  <link rel="apple-touch-icon" href="assets/icons/zion.gif" />
  <meta name="theme-color" content="#0a0f1e" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/main.css" />
  <style>
    /* Markdown rendering tweaks */
    .docs-content pre { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; padding: 1rem; overflow-x: auto; }
    .docs-content code { font-family: var(--font-mono); color: var(--primary); }
    .docs-content table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
    .docs-content th, .docs-content td { border: 1px solid var(--border-color); padding: 0.5rem 0.75rem; }
    .docs-content th { background: var(--bg-secondary); text-align: left; }
    .docs-content blockquote { border-left: 4px solid var(--secondary); padding: 0.75rem 1rem; background: rgba(99,102,241,0.08); color: var(--text-secondary); border-radius: 4px; }
    .wp-meta { color: var(--text-muted); font-size: .95rem; margin-top: .25rem; }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="container">
      <div class="nav-brand">
        <a href="/" class="logo">
          <img src="assets/icons/zion.gif" alt="ZION Logo" width="40" height="40" />
        </a>
        <div class="brand-text">
          <a href="/" class="brand-name">ZION</a>
          <span class="brand-version">TestNet 2.8.5</span>
        </div>
      </div>

      <button class="mobile-toggle" aria-label="Toggle menu">
        <span></span><span></span><span></span>
      </button>

      <ul class="nav-menu">
        <li><a href="index.html">Home</a></li>
        <li class="dropdown">
          <button class="dropdown-toggle" aria-expanded="false">Docs <span class="chevron"></span></button>
          <div class="dropdown-menu">
            <a href="docs/index.html">Overview</a>
            <a href="docs/getting-started.html">Getting Started</a>
            <a href="docs/setup.html">Setup Guide</a>
            <a href="docs/mining-guide.html">Mining Guide</a>
            <a href="docs/consciousness-levels.html">Consciousness Levels</a>
            <a href="docs/api-reference.html">API Reference</a>
            <a href="docs/faq.html">FAQ</a>
            <a href="whitepaper.html" class="nav-highlight">Whitepaper (Full)</a>
          </div>
        </li>
        <li class="dropdown">
          <button class="dropdown-toggle" aria-expanded="false">Network <span class="chevron"></span></button>
          <div class="dropdown-menu">
            <a href="docs/testnet-info.html">TestNet Info</a>
            <a href="docs/pool-setup.html">Pool Setup</a>
            <a href="docs/technical-specs.html">Technical Specs</a>
            <a href="docs/version-history.html">Version History</a>
            <a href="docs/roadmap.html">Roadmap</a>
          </div>
        </li>
        <li class="dropdown">
          <button class="dropdown-toggle" aria-expanded="false">OASIS <span class="chevron"></span></button>
          <div class="dropdown-menu">
            <a href="docs/oasis.html">Overview</a>
          </div>
        </li>
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="https://github.com/Zion-TerraNova/Zion-TestNet2.8.5" target="_blank" class="nav-btn">GitHub</a></li>
      </ul>
    </div>
  </nav>

  <!-- Hero small -->
  <section class="hero hero--sm">
    <div class="container">
      <h1 class="hero-title">ZION Whitepaper v2.8.5 "Milky Way"</h1>
      <p class="hero-description">Full whitepaper rendered on-page. Updated: 3. listopadu 2025.</p>
      <p class="wp-meta">Source: docs/WHITEPAPER_2025/ZION_Whitepaper_v1.0_Full.md</p>
    </div>
  </section>

  <section class="container" style="padding-top:1rem;">
    <div class="docs-layout">
      <aside class="docs-sidebar">
        <div class="sidebar-section">
          <div class="sidebar-section-title">Whitepaper</div>
          <ul id="sidebar-nav" class="sidebar-nav">
            <li><a href="#top" class="active">Introduction</a></li>
          </ul>
        </div>
      </aside>

      <main class="docs-content">
        <div id="wp-container" class="markdown-body">
          <p>Loading whitepaper…</p>
        </div>
      </main>
    </div>
  </section>

  <footer class="footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-col">
          <h4>ZION TestNet</h4>
          <p>TestNet 2.8.5 "Milky Way" - Built for spiritual evolution and community governance</p>
          <div class="social-links">
            <a href="https://github.com/Zion-TerraNova/Zion-TestNet2.8.5" target="_blank" aria-label="GitHub">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .5C5.73.5.77 5.46.77 11.73c0 4.93 3.19 9.1 7.62 10.57.56.1.76-.24.76-.54 0-.26-.01-1.13-.02-2.05-3.1.67-3.76-1.32-3.76-1.32-.51-1.31-1.25-1.66-1.25-1.66-1.02-.7.08-.69.08-.69 1.13.08 1.73 1.16 1.73 1.16 1 .1 1.63-.75 1.63-.75.9-1.55 2.37-1.1 2.95-.84.09-.65.35-1.1.63-1.35-2.48-.28-5.09-1.24-5.09-5.52 0-1.22.44-2.22 1.16-3-.12-.28-.5-1.41.11-2.94 0 0 .95-.31 3.11 1.15a10.8 10.8 0 0 1 2.83-.38c.96 0 1.92.13 2.83.38 2.16-1.46 3.11-1.15 3.11-1.15.61 1.53.23 2.66.11 2.94.72.78 1.16 1.78 1.16 3 0 4.29-2.61 5.23-5.1 5.5.36.3.68.9.68 1.82 0 1.31-.01 2.36-.01 2.68 0 .3.2.64.77.53 4.42-1.47 7.61-5.64 7.61-10.56C23.23 5.46 18.27.5 12 .5Z"/></svg>
            </a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>© 2025 ZION TerraNova. All rights reserved.</p>
        <p>Privacy-first, consciousness-based, multi-chain blockchain.</p>
      </div>
    </div>
  </footer>

  <script src="js/main.js"></script>
  <!-- Marked.js from CDN for Markdown rendering -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    (function(){
      const mdPath = 'docs/whitepaper/ZION_Whitepaper_v2.8.5.md';
      const container = document.getElementById('wp-container');
      const sidebar = document.getElementById('sidebar-nav');

      // Configure marked
      try {
        if (window.marked && marked.setOptions) {
          marked.setOptions({
            breaks: true,
            headerIds: true,
            mangle: false
          });
        }
      } catch (e) {
        console.warn('Marked options setup failed:', e);
      }

      function slugify(text){
        return text.toLowerCase()
          .replace(/[^a-z0-9\s-]/g, '')
          .trim()
          .replace(/\s+/g, '-')
          .replace(/-+/g, '-');
      }

      function buildSidebar(){
        sidebar.innerHTML = '';
        const headers = container.querySelectorAll('h2, h3');
        headers.forEach(h => {
          if (!h.id) { h.id = slugify(h.textContent); }
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = '#' + h.id;
          a.textContent = h.textContent.replace(/^\d+\.\s*/, '');
          if (h.tagName.toLowerCase() === 'h3') {
            const sub = document.createElement('ul');
            sub.className = 'sidebar-sub';
            const subLi = document.createElement('li');
            subLi.appendChild(a);
            sub.appendChild(subLi);
            li.appendChild(sub);
          } else {
            li.appendChild(a);
          }
          sidebar.appendChild(li);
        });
      }

      function addAnchorLinks(){
        container.querySelectorAll('h2, h3').forEach(h => {
          const a = document.createElement('a');
          a.href = '#' + h.id;
          a.className = 'anchor-link';
          a.textContent = '#';
          h.prepend(a);
        });
      }

      function setActiveOnScroll(){
        const links = Array.from(sidebar.querySelectorAll('a'));
        const sections = links.map(a => document.querySelector(a.getAttribute('href'))).filter(Boolean);
        function onScroll(){
          const offset = (document.querySelector('.navbar')?.offsetHeight || 80) + 10;
          let activeIndex = 0;
          sections.forEach((sec, i) => {
            if (sec.getBoundingClientRect().top - offset <= 0) {
              activeIndex = i;
            }
          });
          links.forEach(l => l.classList.remove('active'));
          if (links[activeIndex]) links[activeIndex].classList.add('active');
        }
        document.addEventListener('scroll', onScroll, { passive: true });
        onScroll();
      }

      function renderMarkdown(md){
        if (!window.marked || !marked.parse) {
          console.warn('Marked not available, showing raw markdown');
          container.innerHTML = '<div class="note">Markdown renderer not available. Showing raw document.</div>' +
            '<pre class="code-block"><code></code></pre>';
          container.querySelector('code').textContent = md;
          return;
        }

        // Progressive rendering to avoid blocking on huge documents
        const CHUNK_SIZE = 120000; // ~120k chars per chunk
        if (md.length <= CHUNK_SIZE) {
          container.innerHTML = marked.parse(md);
          buildSidebar();
          addAnchorLinks();
          setActiveOnScroll();
          return;
        }

        container.innerHTML = '';
        let index = 0;
        function renderChunk(){
          if (index >= md.length) {
            buildSidebar();
            addAnchorLinks();
            setActiveOnScroll();
            return;
          }
          const slice = md.slice(index, index + CHUNK_SIZE);
          const section = document.createElement('div');
          section.innerHTML = marked.parse(slice);
          container.appendChild(section);
          index += CHUNK_SIZE;
          requestAnimationFrame(renderChunk);
        }
        renderChunk();
      }

      // Fetch markdown with better diagnostics
      fetch(mdPath, { cache: 'no-store' })
        .then(r => {
          if (!r.ok) throw new Error('Failed to load markdown: ' + r.status + ' ' + r.statusText);
          return r.text();
        })
        .then(md => { renderMarkdown(md); })
        .catch(err => {
          console.error('Whitepaper load error:', err);
          const absLink = mdPath;
          container.innerHTML = `
            <div class="note">
              <strong>Failed to render whitepaper.</strong><br />
              ${String(err)}<br />
              You can <a href="${absLink}" target="_blank">open the markdown file directly here</a>.
            </div>
          `;
        });
    })();
  </script>
</body>
</html>
