<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="ZION TestNet Dashboard - Live network metrics, recent blocks, and performance overview." />
  <title>ZION TestNet Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="icon" href="assets/icons/zion.gif" type="image/gif">
  <link rel="apple-touch-icon" href="assets/icons/zion.gif">
  <meta name="theme-color" content="#0a0f1e">
  <meta property="og:image" content="assets/icons/zion.gif">
  <link rel="stylesheet" href="css/main.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js" defer></script>
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <div class="nav-brand">
        <a href="/" class="logo">
          <img src="assets/icons/zion.gif" alt="ZION Logo" width="40" height="40">
        </a>
        <div class="brand-text">
          <a href="/" class="brand-name">ZION</a>
          <span class="brand-version">TestNet 2.8.5</span>
        </div>
      </div>
      <button class="mobile-toggle" aria-label="Toggle menu">
        <span></span><span></span><span></span>
      </button>
      <ul class="nav-menu">
        <li><a href="index.html#features">Features</a></li>
        <li><a href="index.html#quickstart">Quick Start</a></li>
        <li><a href="docs/">Docs</a></li>
        <li><a href="index.html#stats">Live Stats</a></li>
        <li><a href="dashboard.html" class="nav-highlight">Dashboard</a></li>
        <li><a href="https://github.com/Zion-TerraNova/Zion-TestNet2.8.5" target="_blank" class="nav-btn">GitHub</a></li>
      </ul>
    </div>
  </nav>

  <header class="hero hero--sm">
    <div class="container">
      <h1 class="hero-title">Network Dashboard</h1>
      <p class="hero-description">Live metrics, recent blocks and a simple performance overview.</p>
    </div>
  </header>

  <main class="container" style="padding-top:2rem;padding-bottom:2rem;">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">üì¶</div>
        <div class="stat-data">
          <div class="stat-number" id="stat-blocks">-</div>
          <div class="stat-title">Total Blocks</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">‚ö°</div>
        <div class="stat-data">
          <div class="stat-number" id="stat-difficulty">-</div>
          <div class="stat-title">Difficulty</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üí∞</div>
        <div class="stat-data">
          <div class="stat-number" id="stat-supply">-</div>
          <div class="stat-title">Circulating Supply</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üåê</div>
        <div class="stat-data">
          <div class="stat-number" id="stat-peers">-</div>
          <div class="stat-title">Network Peers</div>
        </div>
      </div>
    </div>

    <div class="features-grid" style="margin-top:2rem;">
      <div class="feature-card" style="grid-column: span 2;">
        <div class="feature-icon">üìà</div>
        <h3>Performance</h3>
        <p>Difficulty-derived hashrate trend (demo from live stats)</p>
        <canvas id="hashrateChart" height="140"></canvas>
      </div>

      <div class="feature-card">
        <div class="feature-icon">üß±</div>
        <h3>Recent Blocks</h3>
        <div id="blocks-list" class="blocks-list"></div>
      </div>
    </div>

    <!-- Extra Panels (Optional) -->
    <div class="features-grid" style="margin-top:2rem;">
      <div class="feature-card">
        <div class="feature-icon">üéÆ</div>
        <h3>GPU Status</h3>
        <p id="gpu-name">‚Äî</p>
        <div>
          <small>Utilization</small>
          <div class="bar"><div id="gpu-util-bar" class="bar-fill"></div></div>
          <div class="bar-label" id="gpu-util">‚Äî%</div>
        </div>
        <div style="margin-top:.5rem;">
          <small>Memory</small>
          <div class="bar"><div id="gpu-mem-bar" class="bar-fill"></div></div>
          <div class="bar-label" id="gpu-mem">‚Äî%</div>
        </div>
        <div style="margin-top:.5rem;">
          <small>Temperature</small>
          <div class="bar"><div id="gpu-temp-bar" class="bar-fill" style="background:#ff6b6b;"></div></div>
          <div class="bar-label" id="gpu-temp">‚Äî ¬∞C</div>
        </div>
      </div>

      <div class="feature-card">
        <div class="feature-icon">üß†</div>
        <h3>AI Compute Bridge</h3>
        <p>Status: <strong id="ai-status">‚Äî</strong></p>
        <div>
          <small>Jobs queued</small>
          <div class="bar"><div id="ai-queue-bar" class="bar-fill" style="background:#60a5fa;"></div></div>
          <div class="bar-label"><span id="ai-queue">0</span></div>
        </div>
        <div style="margin-top:.5rem;">
          <small>Jobs completed</small>
          <div class="bar"><div id="ai-completed-bar" class="bar-fill" style="background:#34d399;"></div></div>
          <div class="bar-label"><span id="ai-completed">0</span></div>
        </div>
      </div>

      <div class="feature-card">
        <div class="feature-icon">üñ•Ô∏è</div>
        <h3>System Resources</h3>
        <div>
          <small>CPU</small>
          <div class="bar"><div id="sys-cpu-bar" class="bar-fill" style="background:#fbbf24;"></div></div>
          <div class="bar-label" id="sys-cpu">‚Äî%</div>
        </div>
        <div style="margin-top:.5rem;">
          <small>RAM</small>
          <div class="bar"><div id="sys-ram-bar" class="bar-fill" style="background:#a78bfa;"></div></div>
          <div class="bar-label" id="sys-ram">‚Äî%</div>
        </div>
        <div style="margin-top:.5rem;">
          <small>Uptime</small>
          <div class="bar"><div id="sys-uptime-bar" class="bar-fill" style="background:#10b981;"></div></div>
          <div class="bar-label" id="sys-uptime">‚Äî</div>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-bottom"><p>&copy; 2025 ZION Blockchain</p></div>
    </div>
  </footer>

  <script src="js/main.js"></script>
  <script src="js/stats.js"></script>
  <script>
    // Lightweight chart that samples current stats and plots a simple trend
    document.addEventListener('DOMContentLoaded', () => {
      const ctx = document.getElementById('hashrateChart').getContext('2d');
      const chart = new Chart(ctx, {
        type: 'line',
        data: { labels: [], datasets: [{
          label: 'Estimated Hashrate',
          data: [],
          borderColor: '#00ff88',
          backgroundColor: 'rgba(0,255,136,0.1)',
          tension: 0.35
        }] },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { labels: { color: '#f9fafb' } } },
          scales: {
            x: { ticks: { color: '#d1d5db' }, grid: { color: 'rgba(255,255,255,0.05)' } },
            y: { ticks: { color: '#d1d5db' }, grid: { color: 'rgba(255,255,255,0.05)' } }
          }
        }
      });

      function sample() {
        const now = new Date().toLocaleTimeString();
        // We approximate hashrate from difficulty value displayed by stats.js
        const diffEl = document.getElementById('stat-difficulty');
        let diff = 0;
        if (diffEl && diffEl.textContent && diffEl.textContent.trim() !== '-') {
          // Remove suffixes and commas for a rough numeric value
          const txt = diffEl.textContent.replace(/,/g, '');
          const m = txt.match(/([0-9.]+)\s*([KMB])?/i);
          if (m) {
            let val = parseFloat(m[1]);
            const suf = (m[2]||'').toUpperCase();
            if (suf === 'K') val *= 1e3; else if (suf === 'M') val *= 1e6; else if (suf === 'B') val *= 1e9;
            diff = val;
          } else {
            diff = parseFloat(txt) || 0;
          }
        }
        const hashrate = diff * 1e6; // mirror estimation from stats.js

        chart.data.labels.push(now);
        chart.data.datasets[0].data.push(hashrate);
        if (chart.data.labels.length > 20) {
          chart.data.labels.shift();
          chart.data.datasets[0].data.shift();
        }
        chart.update('none');
      }

      // Sample every 10s aligned with stats.js updates
      setInterval(sample, 10000);
      // Initial few samples
      setTimeout(sample, 1500);
      setTimeout(sample, 5000);
    });
  </script>
  <script>
    // Minimal styles for bars (scoped)
    (function injectBarStyles(){
      const css = `
        .bar{height:8px;background:rgba(255,255,255,0.08);border-radius:6px;overflow:hidden}
        .bar-fill{height:100%;width:0;background:#00ff88;transition:width .4s ease}
        .bar-label{font-size:.85rem;color:#9ca3af;margin-top:.25rem}
      `;
      const style = document.createElement('style');
      style.innerText = css; document.head.appendChild(style);
    })();

    document.addEventListener('DOMContentLoaded', () => {
      const API_BASE = 'http://www.zionterranova.com/api';

      async function tryFetchJson(path){
        try{
          const ctrl = new AbortController();
          const t = setTimeout(()=>ctrl.abort(), 4000);
          const res = await fetch(`${API_BASE}${path}`, {signal: ctrl.signal});
          clearTimeout(t);
          if(!res.ok) throw new Error('bad status');
          return await res.json();
        }catch(e){ return null; }
      }

      // GPU
      async function updateGPU(){
        const data = await tryFetchJson('/gpu');
        const fallback = !data || !data.devices || !data.devices.length;
        const dev = fallback ? {name:'Demo GPU', util: Math.round(40+Math.random()*50), mem: Math.round(30+Math.random()*60), temp: Math.round(45+Math.random()*25)} : {
          name: data.devices[0].name || 'GPU',
          util: Math.round(data.devices[0].utilization || 0),
          mem: Math.round(data.devices[0].memory_util || 0),
          temp: Math.round(data.devices[0].temperature || 0)
        };
        setText('gpu-name', dev.name);
        setPct('gpu-util', 'gpu-util-bar', dev.util);
        setPct('gpu-mem', 'gpu-mem-bar', dev.mem);
        setText('gpu-temp', `${dev.temp} ¬∞C`);
        setBar('gpu-temp-bar', Math.min(100, Math.max(0, (dev.temp/90)*100)));
      }

      // AI Bridge
      async function updateAI(){
        const data = await tryFetchJson('/ai');
        const fallback = !data;
        const status = fallback ? (Math.random()>0.2?'online':'degraded') : (data.status||'online');
        const queued = fallback ? Math.round(Math.random()*10) : (data.jobs_queued||0);
        const done = fallback ? Math.round(20+Math.random()*200) : (data.jobs_completed||0);
        setText('ai-status', status);
        setBarPct('ai-queue-bar', queued, 50);
        setText('ai-queue', String(queued));
        setBarPct('ai-completed-bar', done%100, 100);
        setText('ai-completed', String(done));
      }

      // System
      async function updateSystem(){
        const data = await tryFetchJson('/system');
        const fallback = !data;
        const cpu = fallback ? Math.round(20+Math.random()*60) : Math.round(data.cpu||0);
        const ram = fallback ? Math.round(30+Math.random()*60) : Math.round(data.ram||0);
        const uptimeSec = fallback ? Math.round(3600 + Math.random()*86400) : Math.round(data.uptime||0);
        setPct('sys-cpu', 'sys-cpu-bar', cpu);
        setPct('sys-ram', 'sys-ram-bar', ram);
        setText('sys-uptime', formatUptime(uptimeSec));
        setBar('sys-uptime-bar', Math.min(100, (uptimeSec % 86400)/86400*100));
      }

      function setText(id, val){ const el = document.getElementById(id); if(el) el.textContent = val; }
      function setBar(id, pct){ const el = document.getElementById(id); if(el) el.style.width = `${pct}%`; }
      function setPct(textId, barId, pct){ setText(textId, `${pct}%`); setBar(barId, pct); }
      function setBarPct(barId, val, max){ const pct = Math.max(0, Math.min(100, (val/max)*100)); setBar(barId, pct); }
      function formatUptime(s){ const d=Math.floor(s/86400); s%=86400; const h=Math.floor(s/3600); s%=3600; const m=Math.floor(s/60); return `${d}d ${h}h ${m}m`; }

      function tick(){ updateGPU(); updateAI(); updateSystem(); }
      tick();
      setInterval(tick, 10000);
    });
  </script>
</body>
</html>
